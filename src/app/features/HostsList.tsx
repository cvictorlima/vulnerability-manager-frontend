import { useEffect, useMemo, useState } from "react";
import { Link } from "react-router-dom";
import { Column, useTable } from "react-table";
import styled from "styled-components";
import getFormatedDateOpt2 from "../../core/utils/getFormatedDateOpt2";
import { Asset } from "../../sdk/@types/Asset";
import AssetService from "../../sdk/services/Asset.service";
import Table from "../components/Table/Table";
import HostChart from "./HostChart";

export interface HostsListProps {
  token: string
}

export default function HostsList ({token}:HostsListProps) {
  const [hostData, setHostData] = useState<Asset.Summary>()

  useEffect(() => {
    AssetService
      .getAllAssets(token)
      .then(response => {
        setHostData(response)
      })
  },[token])
  
//constante contendo as informações a serem enviadas para o componente de tabela. 
//aqui são definidos o conteúdo das colunas e o formato das células na tabela
  const columns = useMemo<Column<Asset.SummaryResult>[]>(
    () => [
      {
        id:'1',
        Header: 'Nome do Host',
        accessor: 'hostname',
        Cell: (props) => <CustomLink 
        to={`/host/${props.row.original.id}`}>{props.value}</CustomLink>
      },
      {
        id:'2',
        Header: 'Endereço de IP',
        accessor: 'ip_address',
        Cell: (props) => <ListItem style={{ display:'flex', justifyContent:'center'}}>{props.value}</ListItem>
      },
      {
        id:'3',
        Header: 'Data de Criação',
        accessor: 'created',
        Cell: (props) => <ListItem>{getFormatedDateOpt2(props.value)}</ListItem>
      },
      {
        id:'4',
        Header: 'Data de Modificação',
        accessor: 'modified',
        Cell: (props) => <ListItem>{getFormatedDateOpt2(props.value)}</ListItem>
      },
      {
        id:'5',
        Header: 'Risco',
        accessor: 'risk',
        Cell: (props) => <ListItem style={{ display:'flex', justifyContent:'center'}}>{props.value}</ListItem>
      },
      {
        id:'6',
        Header: 'Nº de Vuln',
        accessor: 'vuln_count',
        Cell: (props) => <ListItem style={{ display:'flex', justifyContent:'center'}}>{props.value}</ListItem>
      },

    ],
    []
  )

  const instance = useTable<Asset.SummaryResult>({data:hostData?.results || [], columns})
  
  return <Wrapper>
    <div>
      <Head>
        <PageTitle>Lista de Hosts</PageTitle>
      </Head>
      <Info>
        <HostChart token={token} />
      </Info>
    </div>
    <Table instance = {instance} />
  </Wrapper>
}

const Wrapper = styled.div`
display: flex;
flex-direction: column;
gap: 20px;
`

const Head = styled.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: 20px;
  padding-bottom: 20px;
  padding-right: 40px;
  padding-left: 40px;
  background: rgb(2,0,36);
  background: linear-gradient(45deg, rgba(2,0,36,1) 0%, #1f0130 50%, #3b0242 100%);
`

const PageTitle = styled.h2`
  color: white;
`

const Info = styled.div`
display: flex;
justify-content: space-around;
background-color: white;
padding: 12px;
`

const CustomLink = styled(Link)`
text-decoration: none;
cursor: pointer;
color: #D33400;
font-weight: bold;
display: flex;
flex-direction: column;
align-items: center;

:hover{
  color: #274060;
}
`
const ListItem = styled.div`
display: flex;
flex-direction: column;
align-items: center;
`