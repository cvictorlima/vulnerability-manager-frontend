import { useEffect, useMemo, useState } from "react";
import { Link } from "react-router-dom";
import { Column, useTable } from "react-table";
import styled from "styled-components";
import getFormatedDate from "../../core/utils/getFormatedDate";
import { Asset } from "../../sdk/@types/Asset";
import AssetService from "../../sdk/services/Asset.service";
import Table from "../components/Table/Table";
import HostChart from "./HostChart";

export interface HostsListProps {
  token: string
}

export default function HostsList ({token}:HostsListProps) {
  const [hostData, setHostData] = useState<Asset.Summary>()

  useEffect(() => {
    AssetService
      .getAllAssets(token)
      .then(response => {
        setHostData(response)
      })
  },[token])
  
  // const data = useMemo<Asset.SummaryResult[]>(()=> hostData!.results,[hostData])


  const columns = useMemo<Column<Asset.SummaryResult>[]>(
    () => [
      {
        id:'1',
        Header: 'Nome do Host',
        accessor: 'hostname',
        Cell: (props) => <CustomLink 
        to={`/host/${props.row.original.id}`}>{props.value}</CustomLink>
      },
      {
        id:'2',
        Header: 'Endereço de IP',
        accessor: 'ip_address',
        Cell: (props) => <p style={{ display:'flex', justifyContent:'center'}}>{props.value}</p>
      },
      {
        id:'3',
        Header: 'Data de Criação',
        accessor: 'created',
        Cell: (props) => <p>{getFormatedDate(props.value)}</p>
      },
      {
        id:'4',
        Header: 'Data de Modificação',
        accessor: 'modified',
        Cell: (props) => <p>{getFormatedDate(props.value)}</p>
      },
      {
        id:'5',
        Header: 'Risco',
        accessor: 'risk',
        Cell: (props) => <p style={{ display:'flex', justifyContent:'center'}}>{props.value}</p>
      },
      {
        id:'6',
        Header: 'Nº de Vuln',
        accessor: 'vuln_count',
        Cell: (props) => <p style={{ display:'flex', justifyContent:'center'}}>{props.value}</p>
      },

    ],
    []
  )

  const instance = useTable<Asset.SummaryResult>({data:hostData?.results || [], columns})
  
  return <Wrapper>
    <div>
      <Head>
        <PageTitle>Lista de Hosts</PageTitle>
      </Head>
      <Info>
        <HostChart token={token} />
        {/* <VulnerabilityChart token={token} /> */}
      </Info>
    </div>
    <Table instance = {instance} />
  </Wrapper>
  // return <div>{token}</div>
}

const Wrapper = styled.div`
display: flex;
flex-direction: column;
gap: 20px;
`

const Head = styled.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: 20px;
  padding-bottom: 20px;
  padding-right: 40px;
  padding-left: 40px;
  background: rgb(2,0,36);
  background: linear-gradient(45deg, rgba(2,0,36,1) 0%, #1f0130 50%, #3b0242 100%);
`

const PageTitle = styled.h2`
  color: white;
`

const Info = styled.div`
display: flex;
justify-content: space-around;
background-color: white;
padding: 12px;
`

const CustomLink = styled(Link)`
text-decoration: none;
cursor: pointer;
color: #D33400;
font-weight: bold;
display: flex;
flex-direction: column;
align-items: center;

:hover{
  color: #274060;
}
`