import { useEffect, useState } from "react"
import styled from "styled-components"
import CircleChart from "../components/CircleChart"
import { Dashboard } from "../../sdk/@types/Dashboard"
import DashboardService from "../../sdk/services/dashboard.service"

export interface HostChartProps {
  token: string
}

export default function HostChart ({token}:HostChartProps) {
  const [hostData, setHostData] = useState<Dashboard.CardAsset>()

  //useEffect aciona o Serviço de Dashboard ao receber o token como prop do componente
  //O serviço usa Axios para se comunicar com a API
  useEffect(()=> {
    DashboardService
      .getAssetCard(token)
      .then(response=> {setHostData(response)
      })
  },[token])

  if (!hostData)
    return null

  return <HostsChart>
    <CircleChart 
      progress={hostData.vulnerable_asset_count*100/hostData.asset_count}
      size={80}
      strokeWidth={9}
      theme="default"
      value={hostData?.vulnerable_asset_count}
      
      />
    <Section>
      <h3>Hosts Vulneráveis</h3>
      <h5>Total: {hostData.asset_count}</h5>
    </Section>
  </HostsChart>
}


const HostsChart = styled.div`
/* font-size: 2em; */
display: flex;
flex-direction: column;
align-items: center;
gap: 6px;
`

const Section = styled.div`
  display: flex;
  flex-direction: column;
  align-items: center;
`