import { useMemo } from "react";
import { Column, useTable } from "react-table";
import styled from "styled-components";
import getFormatedDateOpt2 from "../../core/utils/getFormatedDateOpt2";
import { Asset } from "../../sdk/@types/Asset";
import Button from "../components/Button/Button";
import Table from "../components/Table/Table";


export interface HostVulnerabilitiesListProps {
  hostData: Asset.Detailed
  handleClick:(props:Asset.VulnerabilityStatus)=>any
}

export default function HostVulnerabilitiesList ({hostData, handleClick}:HostVulnerabilitiesListProps) {

//constante contendo as informações a serem enviadas para o componente de tabela. 
//aqui são definidos o conteúdo das colunas e o formato das células na tabela
  const columns = useMemo<Column<Asset.VulnerabilityStatus>[]>(
    () => [
      {
        Header: 'Id',
        id: '1',
        accessor: 'vulnerability',
        Cell: (props) => <ListItem>{props.value.id}</ListItem>
      },
      {
        Header: 'Título',
        id: '2',
        accessor: 'vulnerability',
        Cell: (props) => <p style={{paddingBottom:'5px' }}>{props.value.title}</p>
      },
      {
        Header: 'Severidade',
        id: '3',
        accessor: 'vulnerability',
        Cell: (props) => <Severity severity={props.value.severity} >{props.value.severity}</Severity> //@ts-ignore 
      },
      {
        Header: 'CVSS',
        id: '4',
        accessor: 'vulnerability',
        Cell: (props) => <ListItem>{props.value.cvss}</ListItem>
      },
      {
        Header: 'Data de Publicação',
        id: '5',
        accessor: 'vulnerability',
        Cell: (props) => <ListItem>{getFormatedDateOpt2(props.value.publication_date!) || '-'}</ListItem>
      },
      {
        Header: 'Status',
        id: '6',
        accessor: 'status',
        Cell: (props) => <Button 
        style={{display:'flex', width:'58px', justifyContent: 'center'}}
        label= { (props.value === 0) ? 'Inativa' : 'Ativa'} 
        variant= { (props.value === 0) ? 'primary' : 'danger'}
        disabled= {!!onclick}
        onClick = {()=>handleClick(props.row.original)}
        />
        
      },
    ],
    []
  )

  const instance = useTable<Asset.VulnerabilityStatus>({data:hostData.vulnerabilities || [], columns})
  
  return <Wrapper>
      <h3>Vulnerabilidades do Host</h3>
      <Table instance = {instance} />
    </Wrapper>
}


const ListItem = styled.div`
display: flex;
flex-direction: column;
align-items: center;
`

const Severity = styled.div<{
  severity: string
}>`
display: flex;
flex-direction: column;
align-items: center;
//para o backgroud color das severidades, há um condicionante que altera a cor de acordo com o conteúdo da célula
background-color: ${p => p.severity === 'Baixo' ? 
'#9cf091c3' : p.severity ==='Médio' ? 
'#f1f373c3' : p.severity === 'Alto' ? 
'#f0b571c3' : '#f16868c3'};
padding-top: 2px;
padding-bottom: 2px;
font-weight: bold;
`

const Wrapper =styled.div`
display: flex;
flex-direction: column;
gap: 6px;
`