import { transparentize } from 'polished';
import styled from 'styled-components';
import { useState } from 'react'
import Button from '../components/Button/Button'
import Input from '../components/Input/Input'
import LoginService from '../../sdk/services/Login.service';
import { useDispatch } from 'react-redux';
import { addToken } from '../../core/store/login.slice';
import { Login } from '../../sdk/@types/Login';
import { useNavigate } from 'react-router-dom';


export default function LoginForm () {

  const [user, setUser] = useState({username:'', password:''});
  const [userToken, setUserToken] = useState<string>()
  const [login, setLogin] = useState<Login.isLogged>()
  const dispatch = useDispatch()
  const navigate = useNavigate()

  function handleFormSubmit (e: React.FormEvent<HTMLFormElement>) {
    e.preventDefault();

    const userdata = {
          "username": user.username,
          "password": user.password,
    };

    LoginService
      .getToken(userdata)
      .then(response => {
        setUserToken(`Token ${response.data.token}`)
        // dispatch(addToken(USER_TOKEN))

      })
      if(!!userToken)
        setLogin({
          isLogged: true,
          username: user.username,
          userToken: userToken
        })

        dispatch(addToken(login!))
      
        navigate('/')
      }

  return <Wrapper>
    <Title>Login</Title>
    <Form onSubmit={handleFormSubmit}>
      <Input label='UsuÃ¡rio' placeholder='cvictorlima' onChange={e=> setUser ({...user, username: e.target.value})} value={user.username} />
      <Input label='Senha' placeholder='**********' type='password' onChange={e=> setUser ({...user, password: e.target.value})} value={user.password} />
      <Button variant='primary' label='LOGIN'  type='submit'/>
    </Form>
  </Wrapper>
}


export const Wrapper = styled.div`
  padding:24px;
  background-color: #F3F8FA;
  display: flex;
  flex-direction: column;
  gap: 24px;
  align-items:center;
  justify-content: center;
  width: 500px;
  border: 1px solid ${transparentize(0.9, '#274060')};
`

export const Title = styled.h2`
  font-size: 24px;
  font-weight: 500;
  display: -webkit-box;
  -webkit-line-clamp:1;
  -webkit-box-orient: vertical;
  line-clamp: 1;
  overflow: hidden;
`

export const Form = styled.form`
  display: flex;
  flex-direction: column;
  gap: 24px;
`